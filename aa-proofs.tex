\chapter{Proofs of \sysf Soundness}
\label{ch:proofsF}
\label{sec:proofsF}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 





%\begin{lemma}\label{WFFTlemmas}
%    For any System F environments $\tcenv$, $\tcenv'$ and $x,y,\al,\al' \not\in dom(\tcenv', \tcenv)$:
%    \item (Change of Free Variables) If $\tcenv', x\bindt \tau_x, \tcenv \vdash_F^w \tau:k$ then $\tcenv', y\bindt t_x, \tcenv \vdash_F^w \tau:k$.  
%    If $\tcenv', \al\bindt k_{\al}, \tcenv \vdash_F^w \tau:k$, then $\tcenv', \al'\bindt k_{\al}, \tcenv \vdash_F^w \tau[\al'/\al]:k$. 
%    \item (Weakening) If $\tcenv', \tcenv \vdash_F^w \tau:k$ then $\tcenv', x\bindt \tau_x, \tcenv \vdash_F^w \tau:k$ and $\tcenv', \al\bindt k_{\al}, \tcenv \vdash_F^w \tau:k$.
%    \item (Substitution Lemma) If $\tcenv', \al\bindt k_{\al}, \tcenv \vdash_F^w \tau:k$ and 
%    $\isWFFT{\tcenv}{\tau_{\al}}{k_{\al}}$ 
%    then $\tcenv'[\tau_{\al}/\al], \tcenv \vdash_F^w \tau[\tau_{\al}/\al]:k$. 
%\end{lemma}
%
%\begin{proof}
%\begin{enumerate}
%\item Change of Free Variables is proven by 
%a straightforward mutual induction on the structure of 
%$\isWFFT{\tcenv', x\bindt \tau_x, \tcenv}{\tau}{k}$, 
%and on the structure of 
%$\isWFFT{\tcenv', \al\bindt k_{\al}, \tcenv}{\tau}{k}$. 
%The one non-trivial detail, which will arise frequently below, is that in the case \wfftPoly, we invert 
%$\isWFFT{\tcenv', x\bindt \tau_x, \tcenv}{\forall\,\al\bindt k.\tau}{*}$
%to obtain
%$\isWFFT{\al'\bindt k, \tcenv', x\bindt \tau_x, \tcenv}{\tau[\al'/\al]}{k_\tau}$
%for some $\al' \not\in {\rm dom}(\tcenv', x\bindt \tau_x, \tcenv)$.
%Before we can apply the inductive hypothesis, we must choose some 
%new fresh 
%$\al'' \not\in {\rm dom}(\tcenv', y\bindt \tau_x, \tcenv) \cup \{x\}$
%because $y$ was not chosen as fresh with respect to an environment
%containing $\al'$. Then we apply the inductive hypothesis twice,
%first obtaining
%$\isWFFT{\al''\bindt k, \tcenv', x\bindt \tau_x, \tcenv}{\tau[\al''/\al]}{k_\tau}$
%and then
%$\isWFFT{\al''\bindt k, \tcenv', y\bindt \tau_x, \tcenv}{\tau[\al''/\al]}{k_\tau}$
%before finally concluding 
%$\isWFFT{\tcenv', y\bindt \tau_x, \tcenv}{\forall\,\al\bindt k.\tau}{*}$
%by rule \wfftPoly.
%\item The proof is a straightforward induction on the structure of
%$\isWFFT{\tcenv',\tcenv}{\tau}{k}$, similar to the Change of Free Variables lemma above. In case \wfftPoly, we invert 
%$\isWFFT{\tcenv', \tcenv}{\forall\,\al\bindt k.\tau}{*}$
%to obtain
%$\isWFFT{\al'\bindt k, \tcenv', \tcenv}{\tau[\al'/\al]}{k_\tau}$
%and use the Change of Free Variables lemma to pick a new $\al''$ 
%that is fresh with respect to $x$ and then apply the inductive hypothesis.
%\item The Substitution Lemma here is proven by induction on the
%structure of
%$\isWFFT{\tcenv', \al\bindt k_{\al}, \tcenv}{\tau}{k}$.
%The proof is straightforward except in the case of rule \wfftVar.
%Here $\tau \equiv \al'$ and we invert 
%$\isWFFT{\tcenv', \al\bindt k_{\al}, \tcenv}{\al'}{k}$
%to get $\al'\bindt k \in \tcenv', \al\bindt k_{\al}, \tcenv$.
%We have three cases depending on where $\al'$ is bound in 
%$\tcenv', \al\bindt k_{\al}, \tcenv$.
%First, if $\al' \bindt k \in \tcenv$, then $\al' \neq \al$ 
%and so $\al'[\tau_{\al}/{\al}] = \al'$.
%...
% 
%Next, if $\al' \bindt k = \al\bindt k_{\al}$, then ...
%
%Finally, if $\al' \bindt k \in \tcenv'$, then $\al' \neq \al$ 
%and so $\al'[\tau_{\al}/{\al}] = \al'$. In particular,
%$\al' \bindt k \in \tcenv'[\tau_{\al}/{\al}]$. ....
%
%$\isWFFT{\tcenv}{\tau_{\al}}{k_{\al}}$ 
%\end{enumerate}
%\end{proof}
